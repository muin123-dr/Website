<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Pengingat Ibadah Harian + Jadwal Sholat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c786c;
            --secondary: #ff9800;
            --accent: #004445;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --gold: #ffd700;
            --text-light: #ffffff;
            --text-yellow: #fff176;
            --text-gold: #ffd54f;
            --prayer-bg: rgba(255, 255, 255, 0.9);
            --prayer-card: #ffffff;
            --prayer-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body {
            background: linear-gradient(135deg, #1a3a3a 0%, #2c786c 50%, #004445 100%);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            border: 3px solid var(--accent);
        }

        .header h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .header p {
            color: #666;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .time-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .time-card {
            background: var(--primary);
            color: var(--text-light);
            padding: 12px 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .time-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .time-card h3 {
            font-size: 0.75rem;
            margin-bottom: 5px;
            color: var(--text-yellow);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .time-card p {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-light);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .time-card .location-text {
            font-size: 0.85rem;
            color: #e8f5e9;
            font-weight: 500;
            min-height: 1.2rem;
        }

        .time-card .date-text {
            font-size: 0.9rem;
            color: #ffffff;
            font-weight: 600;
        }

        .time-card .day-text {
            font-size: 0.8rem;
            color: #bbdefb;
            font-weight: 500;
        }

        .time-card.current-time {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border: 2px solid var(--gold);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3); }
            to { box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5); }
        }

        .time-card.current-time h3 {
            color: var(--text-gold);
            font-size: 0.8rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .time-card.current-time p {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
        }

        #hijri-date {
            background: var(--accent);
        }

        #hijri-date h3 {
            color: #ffecb3;
        }

        #hijri-date p {
            color: #fff9c4;
            font-weight: 600;
        }

        .location-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .location-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 3px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .location-btn:hover {
            background: #e68900;
            transform: scale(1.05);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.25);
        }

        .location-btn:active {
            transform: scale(0.95);
        }

        .location-btn i {
            margin-right: 3px;
        }

        .highlight-box {
            background: linear-gradient(to right, #ff9800, #ff5722);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            animation: pulse 2s infinite;
            box-shadow: 0 8px 25px rgba(255, 152, 0, 0.3);
            border: 2px solid white;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .highlight-box h2 {
            font-size: 1.4rem;
            margin-bottom: 8px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .highlight-box p {
            font-size: 1rem;
            opacity: 0.95;
            color: #fffde7;
            font-weight: 500;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }

        @media (min-width: 992px) {
            .content {
                grid-template-columns: 2fr 1fr;
            }
        }

        .ibadah-list {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-height: 600px;
            overflow-y: auto;
        }

        .ibadah-list h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--secondary);
            font-size: 1.6rem;
        }

        .ibadah-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 12px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border-left: 5px solid var(--primary);
        }

        .ibadah-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left-color: var(--secondary);
        }

        .ibadah-item.important {
            background: linear-gradient(to right, #fff8e1, #ffecb3);
            border-left-color: var(--warning);
        }

        .ibadah-item.urgent {
            background: linear-gradient(to right, #ffebee, #ffcdd2);
            border-left-color: var(--danger);
            animation: urgent-pulse 1.5s infinite;
        }

        @keyframes urgent-pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }

        .ibadah-number {
            background: var(--primary);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .ibadah-info {
            flex: 1;
        }

        .ibadah-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .ibadah-time {
            color: #666;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .ibadah-time i {
            color: var(--primary);
        }

        .checkmark {
            width: 26px;
            height: 26px;
            border: 2px solid #ddd;
            border-radius: 50%;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .checkmark.checked {
            background: var(--success);
            border-color: var(--success);
        }

        .checkmark.checked::after {
            content: "✓";
            color: white;
            font-weight: bold;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .next-ibadah {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .next-ibadah h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary);
            font-size: 1.2rem;
        }

        .next-item {
            background: white;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--info);
        }

        .next-time {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .next-name {
            font-weight: bold;
            color: var(--dark);
            font-size: 0.95rem;
        }

        /* ===== JADWAL SHOLAT CANTIK ===== */
        .prayer-times {
            background: var(--prayer-bg);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
        }

        .prayer-times h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .prayer-card {
            background: var(--prayer-card);
            border-radius: 16px;
            padding: 14px 10px;
            box-shadow: var(--prayer-shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid rgba(44, 120, 108, 0.2);
        }

        .prayer-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }

        .prayer-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            color: white;
            font-size: 1.2rem;
        }

        .prayer-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--dark);
            margin-bottom: 4px;
        }

        .prayer-time-value {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--accent);
            background: #e0f2f1;
            padding: 4px 10px;
            border-radius: 30px;
            display: inline-block;
            margin-top: 4px;
        }

        /* Khusus untuk layar kecil */
        @media (max-width: 400px) {
            .prayer-grid {
                gap: 8px;
            }
            .prayer-card {
                padding: 10px 5px;
            }
            .prayer-time-value {
                font-size: 1rem;
            }
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .progress-container h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary);
            font-size: 1.2rem;
        }

        .progress-bar {
            height: 22px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--accent));
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            color: var(--dark);
            font-size: 0.9rem;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 25px;
            padding: 15px;
            opacity: 0.8;
            font-size: 0.85rem;
        }

        .ibadah-list::-webkit-scrollbar {
            width: 6px;
        }

        .ibadah-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }

        .ibadah-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 8px;
        }

        .ibadah-list::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(150%);
            transition: transform 0.5s ease;
            z-index: 1000;
            font-size: 0.9rem;
        }

        .notification.show {
            transform: translateX(0);
        }

        .loading {
            font-size: 0.8rem;
            color: #e0f7fa;
            font-style: italic;
        }

        .location-loading {
            color: #bbdefb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-mosque"></i> Pengingat Ibadah Harian</h1>
            <p>Berdasarkan waktu real-time dan jadwal sholat lokasi Anda</p>
            
            <div class="time-display">
                <div class="time-card">
                    <h3><i class="fas fa-map-marker-alt"></i> Lokasi</h3>
                    <div class="location-container">
                        <p id="location" class="location-text">Jakarta, Indonesia</p>
                        <button class="location-btn" id="get-location-btn">
                            <i class="fas fa-location-crosshairs"></i> Dapatkan Lokasi
                        </button>
                    </div>
                </div>
                <div class="time-card">
                    <h3><i class="fas fa-calendar-day"></i> Tanggal</h3>
                    <p id="date" class="date-text">7 Feb 2026</p>
                    <p id="day" class="day-text">Sabtu</p>
                </div>
                <div class="time-card" id="hijri-date">
                    <h3><i class="fas fa-moon"></i> Hijriyah</h3>
                    <p id="hijri" class="date-text">Memuat...</p>
                </div>
                <div class="time-card current-time">
                    <h3><i class="fas fa-clock"></i> Waktu Saat Ini</h3>
                    <p id="time">04:30:00</p>
                </div>
            </div>
        </div>

        <div id="highlight-box" class="highlight-box" style="display: none;">
            <h2 id="highlight-title">WAKTU UTAMA IBADAH</h2>
            <p id="highlight-text">Saat ini adalah waktu utama untuk beberapa ibadah penting</p>
        </div>

        <div class="content">
            <div class="ibadah-list">
                <h2><i class="fas fa-tasks"></i> IBADAH YANG BISA ANDA LAKUKAN SAAT INI</h2>
                <div id="ibadah-container">
                    <!-- Ibadah akan dimuat disini secara dinamis -->
                </div>
            </div>

            <div class="sidebar">
                <div class="next-ibadah">
                    <h3><i class="fas fa-calendar-check"></i> Ibadah Berikutnya</h3>
                    <div id="next-ibadah-container">
                        <!-- Ibadah berikutnya akan dimuat disini -->
                    </div>
                </div>

                <!-- JADWAL SHOLAT CANTIK (DITAMBAHKAN) -->
                <div class="prayer-times" id="prayer-times-container">
                    <h3><i class="fas fa-clock"></i> Jadwal Sholat Hari Ini</h3>
                    <div class="prayer-grid" id="prayer-grid">
                        <!-- akan diisi JavaScript -->
                    </div>
                </div>

                <div class="progress-container">
                    <h3><i class="fas fa-chart-line"></i> Progress Hari Ini</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill">0%</div>
                    </div>
                    <div class="progress-stats">
                        <span id="completed">0</span> selesai dari <span id="total">0</span> ibadah
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>© 2024 Pengingat Ibadah Harian | Update real-time setiap detik | Semoga menjadi pengingat kebaikan</p>
            <p style="margin-top: 5px; font-size: 0.75rem; color: #bbdefb;">Data jadwal sholat: Aladhan API (Kemenag)</p>
        </div>
    </div>

    <div class="notification" id="notification">
        Ibadah telah dicentang!
    </div>

    <script>
        // ==================== DATA STATIS IBADAH ====================
        const ibadahData = {
            "beforeFajr": [
                { id: 1, name: "Baca Al-Qur'an", time: "24 jam sehari", important: true, category: "umum" },
                { id: 2, name: "Dzikir & Istighfar", time: "24 jam sehari", important: true, category: "umum" },
                { id: 28, name: "Sholat Tahajud", time: "Setelah tidur - sebelum Subuh", important: true, category: "malam", urgent: true },
                { id: 29, name: "Sholat Witir", time: "Setelah Isya - sebelum Subuh", important: true, category: "malam", urgent: true },
                { id: 32, name: "Doa sepertiga malam", time: "Sepertiga malam terakhir", important: true, category: "malam", urgent: true },
                { id: 33, name: "Sahur", time: "Waktu sahur (sepertiga malam)", important: false, category: "harian" },
                { id: 68, name: "Doa sebelum tidur", time: "Sebelum tidur", important: false, category: "harian" }
            ],
            "fajr": [
                { id: 1, name: "Baca Al-Qur'an", time: "Utama setelah Subuh", important: true, category: "umum", urgent: true },
                { id: 11, name: "Sholat Qobliyah Subuh", time: "Sebelum Subuh", important: true, category: "rawatib", urgent: true },
                { id: 12, name: "Sholat Subuh", time: "Setelah adzan Subuh", important: true, category: "wajib", urgent: true },
                { id: 13, name: "Dzikir pagi", time: "Ba'da Subuh", important: true, category: "dzikir", urgent: true },
                { id: 37, name: "Doa setelah sholat wajib", time: "Ba'da salam", important: true, category: "doa" },
                { id: 65, name: "Tasbih, Tahmid, Takbir", time: "Ba'da sholat", important: false, category: "dzikir" }
            ],
            "morning": [
                { id: 1, name: "Baca Al-Qur'an", time: "24 jam sehari", important: true, category: "umum" },
                { id: 14, name: "Sholat Isyraq", time: "±15 menit setelah matahari terbit", important: false, category: "sunnah" },
                { id: 15, name: "Sholat Dhuha", time: "07.00 - sebelum Dzuhur", important: true, category: "sunnah" },
                { id: 6, name: "Sedekah", time: "24 jam sehari", important: false, category: "umum" },
                { id: 7, name: "Birrul walidain", time: "24 jam sehari", important: false, category: "umum" },
                { id: 9, name: "Menuntut ilmu", time: "24 jam sehari", important: false, category: "umum" }
            ],
            "dhuhr": [
                { id: 1, name: "Baca Al-Qur'an", time: "24 jam sehari", important: false, category: "umum" },
                { id: 16, name: "Sholat Qobliyah Dzuhur", time: "Sebelum Dzuhur", important: true, category: "rawatib", urgent: true },
                { id: 17, name: "Sholat Dzuhur", time: "Setelah matahari tergelincir", important: true, category: "wajib", urgent: true },
                { id: 18, name: "Sholat Ba'diyah Dzuhur", time: "Setelah Dzuhur", important: true, category: "rawatib" },
                { id: 37, name: "Doa setelah sholat wajib", time: "Ba'da salam", important: true, category: "doa" },
                { id: 35, name: "Doa antara adzan–iqamah", time: "Setelah adzan sebelum iqamah", important: false, category: "doa" }
            ],
            "asr": [
                { id: 1, name: "Baca Al-Qur'an", time: "24 jam sehari", important: false, category: "umum" },
                { id: 19, name: "Sholat Ashar", time: "Setelah masuk Ashar", important: true, category: "wajib", urgent: true },
                { id: 20, name: "Dzikir petang", time: "Ba'da Ashar", important: true, category: "dzikir", urgent: true },
                { id: 37, name: "Doa setelah sholat wajib", time: "Ba'da salam", important: true, category: "doa" },
                { id: 8, name: "Silaturahmi", time: "24 jam sehari", important: false, category: "umum" }
            ],
            "maghrib": [
                { id: 1, name: "Baca Al-Qur'an", time: "Utama setelah Maghrib", important: true, category: "umum", urgent: true },
                { id: 21, name: "Sholat Qobliyah Maghrib", time: "Sebelum Maghrib (singkat)", important: false, category: "rawatib" },
                { id: 22, name: "Sholat Maghrib", time: "Setelah adzan Maghrib", important: true, category: "wajib", urgent: true },
                { id: 23, name: "Sholat Ba'diyah Maghrib", time: "Setelah Maghrib", important: true, category: "rawatib" },
                { id: 24, name: "Sholat Awwabin", time: "Antara Maghrib - Isya", important: false, category: "sunnah" },
                { id: 37, name: "Doa setelah sholat wajib", time: "Ba'da salam", important: true, category: "doa" },
                { id: 40, name: "Doa ketika berbuka puasa", time: "Saat Maghrib (berbuka)", important: true, category: "doa", urgent: true }
            ],
            "isha": [
                { id: 1, name: "Baca Al-Qur'an", time: "24 jam sehari", important: false, category: "umum" },
                { id: 25, name: "Sholat Qobliyah Isya", time: "Sebelum Isya", important: false, category: "rawatib" },
                { id: 26, name: "Sholat Isya", time: "Setelah adzan Isya", important: true, category: "wajib", urgent: true },
                { id: 27, name: "Sholat Ba'diyah Isya", time: "Setelah Isya", important: true, category: "rawatib" },
                { id: 29, name: "Sholat Witir", time: "Setelah Isya", important: true, category: "malam" },
                { id: 37, name: "Doa setelah sholat wajib", time: "Ba'da salam", important: true, category: "doa" },
                { id: 67, name: "Doa masuk rumah", time: "Saat masuk rumah", important: false, category: "doa" },
                { id: 68, name: "Doa sebelum tidur", time: "Sebelum tidur", important: false, category: "doa" }
            ]
        };

        const alwaysIbadah = [
            { id: 1, name: "Baca Al-Qur'an", time: "24 jam sehari", important: true, category: "umum" },
            { id: 2, name: "Dzikir & Istighfar", time: "24 jam sehari", important: true, category: "umum" },
            { id: 4, name: "Sholawat Nabi", time: "24 jam sehari", important: true, category: "umum" },
            { id: 5, name: "Doa", time: "24 jam sehari", important: false, category: "umum" },
            { id: 6, name: "Sedekah", time: "24 jam sehari", important: false, category: "umum" },
            { id: 7, name: "Birrul walidain", time: "24 jam sehari", important: false, category: "umum" },
            { id: 8, name: "Silaturahmi", time: "24 jam sehari", important: false, category: "umum" },
            { id: 9, name: "Menuntut ilmu", time: "24 jam sehari", important: false, category: "umum" },
            { id: 10, name: "Amar ma'ruf nahi munkar", time: "24 jam sehari", important: false, category: "umum" },
            { id: 100, name: "Mendengarkan kajian", time: "24 jam sehari", important: false, category: "umum" }
        ];

        // Jadwal statis (default)
        const staticSchedule = [
            { time: "04:30", name: "Sholat Subuh", period: "Subuh" },
            { time: "06:12", name: "Syuruq", period: "Pagi" },
            { time: "12:00", name: "Sholat Dzuhur", period: "Siang" },
            { time: "15:30", name: "Sholat Ashar", period: "Sore" },
            { time: "18:00", name: "Sholat Maghrib", period: "Petang" },
            { time: "19:30", name: "Sholat Isya", period: "Malam" }
        ];

        const highlightTimes = [
            { start: "03:00", end: "05:00", title: "SEPERTIGA MALAM TERAKHIR", text: "Waktu mustajab untuk doa, tahajud, dan istighfar" },
            { start: "04:30", end: "06:00", title: "WAKTU SUBUH", text: "Waktu utama membaca Quran, dzikir pagi, dan sholat sunnah" },
            { start: "12:00", end: "13:00", title: "WAKTU DZUHUR", text: "Sholat berjamaah dan doa antara adzan-iqamah" },
            { start: "15:30", end: "17:00", title: "WAKTU ASHAR", text: "Dzikir petang dan menjaga sholat Ashar" },
            { start: "18:00", end: "19:00", title: "WAKTU MAGHRIB", text: "Waktu mustajab doa dan utama membaca Quran" },
            { start: "19:30", end: "20:30", title: "WAKTU ISYA", text: "Sholat berjamaah dan witir" },
            { start: "07:00", end: "10:30", title: "WAKTU DHUHA", text: "Sholat Dhuha dan sedekah" }
        ];

        // ==================== VARIABEL GLOBAL ====================
        let completedIbadah = [];
        let previousPeriod = '';
        let dynamicPrayerSchedule = []; // untuk jadwal dari API

        // ==================== FUNGSI UTAMA ====================
        function updateTime() {
            const now = new Date();
            
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const dateOptions = { day: 'numeric', month: 'short', year: 'numeric' };
            const dayOptions = { weekday: 'long' };
            
            document.getElementById('time').textContent = now.toLocaleTimeString('id-ID', timeOptions);
            document.getElementById('date').textContent = now.toLocaleDateString('id-ID', dateOptions);
            document.getElementById('day').textContent = now.toLocaleDateString('id-ID', dayOptions);
            
            updateHijriDate(now);
            
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTimeStr = `${currentHour.toString().padStart(2, '0')}:${currentMinute.toString().padStart(2, '0')}`;
            
            // Tentukan periode
            let periodeKey = '';
            if (currentHour >= 0 && currentHour < 4.5) periodeKey = 'beforeFajr';
            else if (currentHour >= 4.5 && currentHour < 6) periodeKey = 'fajr';
            else if (currentHour >= 6 && currentHour < 10.5) periodeKey = 'morning';
            else if (currentHour >= 10.5 && currentHour < 15.5) periodeKey = 'dhuhr';
            else if (currentHour >= 15.5 && currentHour < 18) periodeKey = 'asr';
            else if (currentHour >= 18 && currentHour < 19.5) periodeKey = 'maghrib';
            else periodeKey = 'isha';

            // Reset centang jika periode berganti
            if (previousPeriod !== periodeKey) {
                completedIbadah = [];
                previousPeriod = periodeKey;
            }

            const isFriday = now.getDay() === 5;

            let periodeIbadah = ibadahData[periodeKey];

            // Jika Jumat dan periode Dzuhur, ganti Sholat Dzuhur dengan Sholat Jum'ah
            if (isFriday && periodeKey === 'dhuhr') {
                periodeIbadah = periodeIbadah.map(item => {
                    if (item.id === 17) return { ...item, name: "Sholat Jum'ah", time: "Waktu Jum'at" };
                    return item;
                });
            }

            let currentIbadah = [...alwaysIbadah, ...periodeIbadah];

            // Tambah "Menelpon orang tua/keluarga" jika jam 05.00-21.00
            if (currentHour >= 5 && currentHour < 21) {
                currentIbadah.push({ id: 101, name: "Menelpon orang tua/keluarga", time: "05.00 - 21.00", important: false, category: "umum" });
            }

            // Tambah item khusus Jumat
            if (isFriday) {
                currentIbadah.push({ id: 102, name: "Perbanyak doa, dzikir, sholawat", time: "Sepanjang hari Jumat", important: true, category: "jumat" });
                if (currentTimeStr >= "12:00" && currentTimeStr <= "13:00") {
                    currentIbadah.push({ id: 103, name: "Waktu mustajab antara dua khotbah", time: "Saat khotbah Jumat", important: true, urgent: true, category: "jumat" });
                }
                if (currentTimeStr >= "15:30" && currentTimeStr <= "18:00") {
                    currentIbadah.push({ id: 104, name: "Waktu mustajab setelah Ashar", time: "Ashar hingga Maghrib", important: true, urgent: true, category: "jumat" });
                }
            }

            // Hapus duplikat
            const uniqueIbadah = [];
            const seenIds = new Set();
            currentIbadah.forEach(ib => {
                if (!seenIds.has(ib.id)) {
                    seenIds.add(ib.id);
                    uniqueIbadah.push(ib);
                }
            });

            updateHighlightBox(currentTimeStr, isFriday);
            displayIbadah(uniqueIbadah);

            // Update ibadah berikutnya (pakai API jika ada)
            if (dynamicPrayerSchedule.length > 0) {
                updateNextIbadahFromAPI(currentTimeStr);
            } else {
                updateNextIbadahStatic(currentTimeStr);
            }

            // Update progress
            updateProgress();
        }

        function updateHighlightBox(currentTime, isFriday) {
            const box = document.getElementById('highlight-box');
            let show = false;
            if (isFriday) {
                document.getElementById('highlight-title').textContent = "HARI JUMAT YANG MULIA";
                document.getElementById('highlight-text').textContent = "Perbanyak doa, dzikir, sholawat. Waktu mustajab: antara dua khotbah & setelah Ashar.";
                show = true;
            } else {
                for (const h of highlightTimes) {
                    if (currentTime >= h.start && currentTime <= h.end) {
                        document.getElementById('highlight-title').textContent = h.title;
                        document.getElementById('highlight-text').textContent = h.text;
                        show = true;
                        break;
                    }
                }
            }
            box.style.display = show ? 'block' : 'none';
        }

        function displayIbadah(list) {
            const container = document.getElementById('ibadah-container');
            container.innerHTML = '';
            list.forEach((ib, idx) => {
                const checked = completedIbadah.includes(ib.id);
                let cls = 'ibadah-item';
                if (ib.important) cls += ' important';
                if (ib.urgent) cls += ' urgent';
                const el = document.createElement('div');
                el.className = cls;
                el.innerHTML = `
                    <div class="ibadah-number">${idx+1}</div>
                    <div class="ibadah-info">
                        <div class="ibadah-name">${ib.name}</div>
                        <div class="ibadah-time"><i class="far fa-clock"></i> ${ib.time}</div>
                    </div>
                    <div class="checkmark ${checked ? 'checked' : ''}" data-id="${ib.id}"></div>
                `;
                container.appendChild(el);
            });
            document.querySelectorAll('.checkmark').forEach(c => {
                c.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    toggleIbadah(id, this);
                });
            });
        }

        function toggleIbadah(id, el) {
            const idx = completedIbadah.indexOf(id);
            if (idx === -1) {
                completedIbadah.push(id);
                el.classList.add('checked');
                showNotification('Ibadah telah dicentang!');
            } else {
                completedIbadah.splice(idx, 1);
                el.classList.remove('checked');
            }
            updateProgress();
        }

        function showNotification(msg) {
            const notif = document.getElementById('notification');
            notif.textContent = msg;
            notif.classList.add('show');
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        function updateNextIbadahStatic(currentTime) {
            const container = document.getElementById('next-ibadah-container');
            container.innerHTML = '';
            let next = null;
            for (const ib of staticSchedule) {
                if (ib.time > currentTime) { next = ib; break; }
            }
            if (!next) next = staticSchedule[0];
            const nextEl = document.createElement('div');
            nextEl.className = 'next-item';
            nextEl.innerHTML = `<div class="next-time">${next.time}</div><div class="next-name">${next.name}</div><div style="color: #666; font-size: 0.85rem;">${next.period}</div>`;
            container.appendChild(nextEl);
            const idx = staticSchedule.indexOf(next);
            const next2 = staticSchedule[(idx + 1) % staticSchedule.length];
            const next2El = document.createElement('div');
            next2El.className = 'next-item';
            next2El.innerHTML = `<div class="next-time">${next2.time}</div><div class="next-name">${next2.name}</div><div style="color: #666; font-size: 0.85rem;">${next2.period}</div>`;
            container.appendChild(next2El);
        }

        function updateNextIbadahFromAPI(currentTime) {
            if (!dynamicPrayerSchedule.length) return;
            const container = document.getElementById('next-ibadah-container');
            container.innerHTML = '';
            let next = null;
            for (const ib of dynamicPrayerSchedule) {
                if (ib.time > currentTime) { next = ib; break; }
            }
            if (!next) next = dynamicPrayerSchedule[0];
            const nextEl = document.createElement('div');
            nextEl.className = 'next-item';
            nextEl.innerHTML = `<div class="next-time">${next.time}</div><div class="next-name">${next.name}</div><div style="color: #666; font-size: 0.85rem;">${next.period}</div>`;
            container.appendChild(nextEl);
            const idx = dynamicPrayerSchedule.indexOf(next);
            const next2 = dynamicPrayerSchedule[(idx + 1) % dynamicPrayerSchedule.length];
            const next2El = document.createElement('div');
            next2El.className = 'next-item';
            next2El.innerHTML = `<div class="next-time">${next2.time}</div><div class="next-name">${next2.name}</div><div style="color: #666; font-size: 0.85rem;">${next2.period}</div>`;
            container.appendChild(next2El);
        }

        function updateProgress() {
            const total = document.querySelectorAll('.ibadah-item').length;
            const done = completedIbadah.length;
            const percent = total ? Math.round((done / total) * 100) : 0;
            document.getElementById('progress-fill').style.width = percent + '%';
            document.getElementById('progress-fill').textContent = percent + '%';
            document.getElementById('completed').textContent = done;
            document.getElementById('total').textContent = total;
        }

        // ==================== JADWAL SHOLAT (TAMPILAN CANTIK) ====================
        function displayPrayerTimes() {
            const grid = document.getElementById('prayer-grid');
            grid.innerHTML = '';

            // Tentukan sumber data: API jika ada, else statis
            let source = dynamicPrayerSchedule.length ? dynamicPrayerSchedule : staticSchedule;

            // Kita hanya ingin 5 waktu wajib: Subuh, Dzuhur, Ashar, Maghrib, Isya
            const wajib = ['Subuh', 'Dzuhur', 'Ashar', 'Maghrib', 'Isya'];
            const filtered = source.filter(item => {
                return wajib.some(w => item.name.includes(w));
            });

            // Urutan: Subuh, Dzuhur, Ashar, Maghrib, Isya
            const order = { 'Subuh': 1, 'Dzuhur': 2, 'Ashar': 3, 'Maghrib': 4, 'Isya': 5 };
            filtered.sort((a, b) => {
                const aName = a.name.replace('Sholat ', '');
                const bName = b.name.replace('Sholat ', '');
                return (order[aName] || 99) - (order[bName] || 99);
            });

            // Ikon masing-masing
            const icons = {
                'Subuh': 'fa-sun',
                'Dzuhur': 'fa-sun',
                'Ashar': 'fa-sun',
                'Maghrib': 'fa-sun',
                'Isya': 'fa-moon'
            };

            filtered.forEach(item => {
                let nama = item.name.replace('Sholat ', '');
                if (nama.includes('Jum')) nama = 'Jum\'at'; // jika Jumat
                const icon = icons[nama] || 'fa-clock';
                const card = document.createElement('div');
                card.className = 'prayer-card';
                card.innerHTML = `
                    <div class="prayer-icon"><i class="fas ${icon}"></i></div>
                    <div class="prayer-name">${nama}</div>
                    <div class="prayer-time-value">${item.time}</div>
                `;
                grid.appendChild(card);
            });
        }

        // ==================== API JADWAL SHOLAT ====================
        async function fetchPrayerTimes(lat, lon) {
            const container = document.getElementById('next-ibadah-container');
            container.innerHTML = '<p class="loading">Memuat jadwal sholat...</p>';
            try {
                const today = new Date();
                const day = String(today.getDate()).padStart(2, '0');
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const year = today.getFullYear();
                const dateStr = `${day}-${month}-${year}`;
                const url = `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${lat}&longitude=${lon}&method=11`;
                const res = await fetch(url);
                const data = await res.json();
                if (data.code === 200 && data.data) {
                    const t = data.data.timings;
                    dynamicPrayerSchedule = [
                        { time: t.Fajr, name: "Sholat Subuh", period: "Subuh" },
                        { time: t.Sunrise, name: "Syuruq", period: "Pagi" },
                        { time: t.Dhuhr, name: "Sholat Dzuhur", period: "Siang" },
                        { time: t.Asr, name: "Sholat Ashar", period: "Sore" },
                        { time: t.Maghrib, name: "Sholat Maghrib", period: "Petang" },
                        { time: t.Isha, name: "Sholat Isya", period: "Malam" }
                    ];
                    // Tampilkan jadwal cantik
                    displayPrayerTimes();
                    const now = new Date();
                    const currentTimeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
                    updateNextIbadahFromAPI(currentTimeStr);
                } else {
                    throw new Error('Gagal ambil data');
                }
            } catch (err) {
                console.error(err);
                dynamicPrayerSchedule = [];
                displayPrayerTimes(); // tampilkan statis
                const now = new Date();
                const currentTimeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
                updateNextIbadahStatic(currentTimeStr);
            }
        }

        // ==================== LOKASI ====================
        async function getLocation() {
            const locEl = document.getElementById('location');
            const btn = document.getElementById('get-location-btn');
            locEl.innerHTML = '<span class="loading location-loading">Mendapatkan lokasi...</span>';
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memuat...';

            if (!navigator.geolocation) {
                locEl.textContent = "Geolocation tidak didukung";
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-location-crosshairs"></i> Coba Lagi';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async (pos) => {
                    try {
                        const rev = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`);
                        const data = await rev.json();
                        let city = data.address?.city || data.address?.town || data.address?.village || data.address?.county || '';
                        let country = data.address?.country || '';
                        locEl.textContent = city ? `${city}, ${country}` : "Lokasi ditemukan";
                        localStorage.setItem('userLocation', JSON.stringify({
                            city, country,
                            lat: pos.coords.latitude,
                            lon: pos.coords.longitude
                        }));
                        await fetchPrayerTimes(pos.coords.latitude, pos.coords.longitude);
                    } catch (e) {
                        locEl.textContent = "Lokasi Anda";
                    }
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-location-crosshairs"></i> Dapatkan Lokasi';
                    showNotification('Lokasi berhasil diperbarui!');
                },
                (err) => {
                    locEl.textContent = "Lokasi tidak tersedia";
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-location-crosshairs"></i> Coba Lagi';
                    showNotification('Gagal mendapatkan lokasi.');
                },
                { timeout: 10000 }
            );
        }

        // ==================== HIJRI ====================
        async function updateHijriDate(greg) {
            const el = document.getElementById('hijri');
            const todayStr = greg.toDateString();
            const stored = JSON.parse(localStorage.getItem('hijriDate'));
            if (stored && stored.date === todayStr) {
                el.textContent = stored.hijri;
                return;
            }
            try {
                const d = String(greg.getDate()).padStart(2,'0');
                const m = String(greg.getMonth()+1).padStart(2,'0');
                const y = greg.getFullYear();
                const resp = await fetch(`https://api.aladhan.com/v1/gToH?date=${d}-${m}-${y}`);
                const data = await resp.json();
                if (data.code === 200) {
                    const hij = data.data.hijri;
                    const str = `${hij.day} ${hij.month.en} ${hij.year} H`;
                    localStorage.setItem('hijriDate', JSON.stringify({ date: todayStr, hijri: str }));
                    el.textContent = str;
                } else throw new Error();
            } catch {
                const months = ['Muharram','Safar','Rabiul Awal','Rabiul Akhir','Jumadil Awal','Jumadil Akhir','Rajab','Sya\'ban','Ramadhan','Syawal','Dzulqa\'dah','Dzulhijjah'];
                el.textContent = `20 ${months[6]} 1447 H`; // fallback
            }
        }

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            document.getElementById('get-location-btn').addEventListener('click', getLocation);

            const savedLoc = JSON.parse(localStorage.getItem('userLocation'));
            if (savedLoc) {
                document.getElementById('location').textContent = `${savedLoc.city}, ${savedLoc.country}`;
                fetchPrayerTimes(savedLoc.lat, savedLoc.lon);
            } else {
                // Tampilkan jadwal statis
                displayPrayerTimes();
            }
            updateHijriDate(new Date());
        });
    </script>
</body>
</html>
